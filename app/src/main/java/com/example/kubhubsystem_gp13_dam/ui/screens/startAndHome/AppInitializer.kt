package com.example.kubhubsystem_gp13_dam.ui.screens.startAndHome

import android.util.Log
import com.example.kubhubsystem_gp13_dam.data.repository.AsignaturaRepository
import com.example.kubhubsystem_gp13_dam.data.repository.RecetaRepository
import com.example.kubhubsystem_gp13_dam.data.repository.SalaRepository
import com.example.kubhubsystem_gp13_dam.local.AppDatabase
import com.example.kubhubsystem_gp13_dam.repository.DocenteRepository
import com.example.kubhubsystem_gp13_dam.repository.InventarioRepository
import com.example.kubhubsystem_gp13_dam.repository.ProductoRepository
import com.example.kubhubsystem_gp13_dam.repository.ReservaSalaRepository
import com.example.kubhubsystem_gp13_dam.repository.RolRepository
import com.example.kubhubsystem_gp13_dam.repository.SeccionRepository
import com.example.kubhubsystem_gp13_dam.repository.UsuarioRepository
import kotlinx.coroutines.delay

class AppInitializer(private val db: AppDatabase) {

    suspend fun inicializarTodo(onProgress: (String) -> Unit = {}) {
        val tag = "AppInitializer"

        onProgress("Configurando roles")
        val rolRepository = RolRepository(db.rolDao())
        rolRepository.inicializarRoles()
        Log.d(tag, "âœ… Roles inicializados")

        onProgress("Creando usuarios")
        val usuarioRepository = UsuarioRepository(db.usuarioDao())
        usuarioRepository.inicializarUsuarios()
        Log.d(tag, "âœ… Usuarios creados")

        onProgress("Registrando docentes")
        val docenteRepository = DocenteRepository(db.docenteDao())
        docenteRepository.inicializarDocentes(usuarioRepository.obtenerTodos())
        Log.d(tag, "âœ… Docentes registrados")

        onProgress("Inicializando productos")
        val productoRepository = ProductoRepository(db.productoDao())
        productoRepository.inicializarProductos()
        Log.d(tag, "âœ… Productos inicializados")

        onProgress("Actualizando inventario")
        val inventarioRepository = InventarioRepository(db.inventarioDao(), db.productoDao())
        inventarioRepository.inicializarInventario()
        Log.d(tag, "âœ… Inventario actualizado")

        onProgress("Cargando recetas")
        val recetaRepository = RecetaRepository(
            db.recetaDao(),
            db.detalleRecetaDao(),
            db.productoDao(),
            db.inventarioDao()
        )
        recetaRepository.inicializarRecetas()
        Log.d(tag, "âœ… Recetas cargadas")

        onProgress("Cargando asignaturas")
        val asignaturaRepository = AsignaturaRepository(db.asignaturaDao())
        asignaturaRepository.inicializarAsignaturas()
        Log.d(tag, "âœ… Asignaturas cargadas")

        onProgress("Preparando salas")
        val salaRepository = SalaRepository(db.salaDao())
        salaRepository.inicializarSalas()
        Log.d(tag, "âœ… Salas preparadas")

        onProgress("Configurando secciones")
        val seccionRepository = SeccionRepository(db.seccionDao())
        seccionRepository.inicializarSecciones()
        Log.d(tag, "âœ… Secciones configuradas")

        onProgress("Procesando reservas")
        // âœ… CORRECCIÃ“N: Pasar los 3 DAOs necesarios
        val reservaSalaRepository = ReservaSalaRepository(
            reservaSalaDAO = db.reservaSalaDao(),
            salaDAO = db.salaDao(),
            asignaturaDAO = db.asignaturaDao()
        )
        reservaSalaRepository.inicializarReservas()
        Log.d(tag, "âœ… Reservas procesadas")

        onProgress("Completado")
        Log.d(tag, "ðŸŽ‰ Base de datos inicializada COMPLETAMENTE")
    }
}
/**
 * Log.d(...)
 * Es una clase utilitaria de Android que proporciona mÃ©todos para enviar mensajes al Logcat
 * (la ventana de registro del sistema Android en el IDE, como Android Studio).
 *
 * Log.d(tag, "...")
 * Es el mÃ©todo de la clase Log que indica el nivel de prioridad del mensaje.
 * La 'd' significa Debug (DepuraciÃ³n). Estos mensajes se usan para registrar
 * informaciÃ³n detallada sobre el funcionamiento normal de un programa.
 *
 * Log.d("AppInitializer", ...)
 * El primer argumento. Es una cadena de texto (String) usada para identificar el origen del
 * mensaje de registro. En tu cÃ³digo, tag es la variable que contiene "AppInitializer".
 * Esto permite filtrar fÃ¡cilmente los mensajes en Logcat
 *
 * Log.d(..., "âœ… Roles inicializados")
 * El segundo argumento. Es el mensaje real que se va a mostrar. Suele describir el evento
 * que acaba de ocurrir. El emoji âœ… es Ãºtil para hacer el mensaje mÃ¡s visible y fÃ¡cil de
 * identificar en el flujo de Logcat.
 * */